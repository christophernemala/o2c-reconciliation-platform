<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O2C Reconciliation Platform - Premium Edition</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>:root{--royal-blue:#1e3a8a;--royal-purple:#6b21a8;--royal-gold:#d4af37;--deep-navy:#0f172a;--midnight:#1e293b;--slate:#334155;--silver:#e2e8f0;--platinum:#f8fafc;--accent-blue:#3b82f6;--accent-purple:#a855f7;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--gradient-royal:linear-gradient(135deg,#1e3a8a 0%,#6b21a8 50%,#1e3a8a 100%);--gradient-gold:linear-gradient(135deg,#d4af37 0%,#ffd700 100%);--glass-bg:rgba(30,58,138,0.1);--glass-border:rgba(212,175,55,0.3);--card-bg:rgba(15,23,42,0.8);--card-border:rgba(212,175,55,0.2)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Poppins',sans-serif;background:var(--gradient-royal);min-height:100vh;color:var(--platinum);position:relative;overflow-x:hidden}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%,rgba(212,175,55,0.15) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(168,85,247,0.15) 0%,transparent 50%);pointer-events:none;z-index:0}.container{max-width:1800px;margin:0 auto;padding:0 2rem;position:relative;z-index:1}.header{background:rgba(15,23,42,0.95);backdrop-filter:blur(20px);border-bottom:2px solid var(--royal-gold);padding:1.5rem 0;position:sticky;top:0;z-index:1000;box-shadow:0 10px 40px rgba(0,0,0,0.5)}.header-content{display:flex;justify-content:space-between;align-items:center;gap:2rem;flex-wrap:wrap}.logo{display:flex;align-items:center;gap:1rem}.logo svg{filter:drop-shadow(0 0 15px var(--royal-gold))}.logo h1{font-size:2rem;font-weight:800;background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:1px}.badge{background:var(--gradient-gold);color:var(--deep-navy);padding:0.4rem 1rem;border-radius:25px;font-size:0.75rem;font-weight:700;box-shadow:0 4px 20px rgba(212,175,55,0.5);display:flex;align-items:center;gap:0.3rem}.nav{display:flex;gap:1rem}.nav-btn{background:rgba(212,175,55,0.1);border:1px solid var(--royal-gold);color:var(--royal-gold);padding:0.8rem 1.8rem;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.3s;font-family:'Poppins',sans-serif}.nav-btn:hover{background:var(--royal-gold);color:var(--deep-navy);transform:translateY(-2px);box-shadow:0 8px 25px rgba(212,175,55,0.4)}.main-content{padding:3rem 0}.section-header{text-align:center;margin-bottom:3rem}.section-header h2{font-size:3rem;font-weight:800;background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:0.5rem}.section-header p{color:var(--silver);font-size:1.1rem}.upload-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:2rem;margin-bottom:2rem}.upload-box{background:var(--card-bg);backdrop-filter:blur(20px);border:2px dashed var(--glass-border);border-radius:20px;padding:3rem;transition:all 0.4s;cursor:pointer;position:relative;overflow:hidden}.upload-box::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(212,175,55,0.1) 0%,transparent 70%);opacity:0;transition:opacity 0.4s}.upload-box:hover::before{opacity:1}.upload-box:hover{border-color:var(--royal-gold);transform:translateY(-5px);box-shadow:0 20px 60px rgba(212,175,55,0.3)}.upload-box.uploaded{border-style:solid;border-color:var(--royal-gold);background:rgba(212,175,55,0.05)}.file-input{display:none}.upload-label{display:flex;flex-direction:column;align-items:center;gap:1rem;cursor:pointer;text-align:center;position:relative;z-index:1}.upload-icon{color:var(--royal-gold);transition:all 0.3s}.upload-box:hover .upload-icon{transform:translateY(-10px) scale(1.1)}.upload-label h3{font-size:1.8rem;font-weight:700;color:var(--platinum)}.upload-label p{color:var(--silver)}.file-name{background:rgba(212,175,55,0.2);color:var(--royal-gold);padding:0.6rem 1.2rem;border-radius:12px;font-weight:600;display:none;border:1px solid var(--royal-gold)}.upload-box.uploaded .file-name{display:block}.data-preview{background:rgba(15,23,42,0.9);border:1px solid var(--royal-gold);border-radius:12px;padding:1.5rem;margin-top:1.5rem;font-size:0.9rem;text-align:left;max-height:250px;overflow-y:auto;display:none}.data-preview.show{display:block}.data-preview h4{color:var(--royal-gold);margin-bottom:1rem;font-size:1.1rem;display:flex;align-items:center;gap:0.5rem}.data-preview table{width:100%;border-collapse:collapse;font-size:0.85rem}.data-preview th{background:rgba(212,175,55,0.2);padding:0.8rem;text-align:left;color:var(--royal-gold);border-bottom:2px solid var(--royal-gold);font-weight:600}.data-preview td{padding:0.8rem;border-bottom:1px solid rgba(212,175,55,0.2);color:var(--silver)}.data-preview tr:hover{background:rgba(212,175,55,0.05)}.btn-primary,.btn-secondary{display:inline-flex;align-items:center;gap:0.5rem;padding:1rem 2.5rem;border-radius:12px;font-weight:700;cursor:pointer;transition:all 0.3s;border:none;font-family:'Poppins',sans-serif;font-size:1rem}.btn-primary{background:var(--gradient-gold);color:var(--deep-navy);box-shadow:0 10px 30px rgba(212,175,55,0.4)}.btn-primary:hover{transform:translateY(-3px);box-shadow:0 15px 40px rgba(212,175,55,0.6)}.btn-secondary{background:rgba(212,175,55,0.1);color:var(--royal-gold);border:2px solid var(--royal-gold)}.btn-secondary:hover{background:var(--royal-gold);color:var(--deep-navy)}.reconciliation-engine{background:var(--card-bg);backdrop-filter:blur(20px);border:2px solid var(--royal-gold);border-radius:25px;padding:4rem;margin:3rem 0;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.5)}.engine-icon{color:var(--royal-gold);filter:drop-shadow(0 0 30px var(--royal-gold));display:inline-block;margin-bottom:2rem}.rotating{animation:rotate 3s linear infinite}@keyframes rotate{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.engine-content h2{font-size:2.5rem;font-weight:800;background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:1rem}.progress-bar{width:100%;height:15px;background:rgba(15,23,42,0.8);border-radius:10px;overflow:hidden;margin:2rem 0;border:1px solid var(--royal-gold)}.progress-fill{height:100%;background:var(--gradient-gold);border-radius:10px;width:0;transition:width 0.5s;box-shadow:0 0 20px rgba(212,175,55,0.8)}.progress-text{font-size:2rem;font-weight:800;color:var(--royal-gold);margin:1rem 0}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:2rem;margin-bottom:3rem}.stat-card{background:var(--card-bg);backdrop-filter:blur(20px);border-radius:20px;padding:2rem;display:flex;align-items:center;gap:2rem;transition:all 0.3s;border:2px solid var(--glass-border);box-shadow:0 10px 30px rgba(0,0,0,0.3)}.stat-card:hover{transform:translateY(-5px);box-shadow:0 20px 50px rgba(212,175,55,0.3);border-color:var(--royal-gold)}.stat-icon-wrapper{width:70px;height:70px;border-radius:15px;display:flex;align-items:center;justify-content:center;background:rgba(212,175,55,0.1);border:2px solid var(--royal-gold)}.stat-content h4{font-size:0.9rem;color:var(--silver);margin-bottom:0.5rem;font-weight:500}.stat-value{font-size:2.5rem;font-weight:800;background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.stat-subtitle{font-size:0.85rem;color:var(--silver);margin-top:0.3rem}.charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:2rem;margin-bottom:3rem}.chart-card{background:var(--card-bg);backdrop-filter:blur(20px);border:2px solid var(--glass-border);border-radius:25px;padding:2.5rem;box-shadow:0 15px 40px rgba(0,0,0,0.4)}.chart-card h3{text-align:center;margin-bottom:2rem;font-size:1.8rem;font-weight:700;color:var(--royal-gold)}.table-controls{display:flex;justify-content:space-between;gap:2rem;margin-bottom:2rem;flex-wrap:wrap}.search-box{display:flex;align-items:center;gap:0.8rem;background:var(--card-bg);border:2px solid var(--glass-border);border-radius:12px;padding:1rem 1.5rem;flex:1;max-width:500px}.search-box:focus-within{border-color:var(--royal-gold)}.search-box input{background:0 0;border:none;color:var(--platinum);outline:0;width:100%;font-family:'Poppins',sans-serif;font-size:1rem}.search-box input::placeholder{color:var(--silver)}.filter-tabs{display:flex;gap:0.5rem;background:var(--card-bg);border:2px solid var(--glass-border);border-radius:12px;padding:0.5rem}.tab-btn{background:0 0;border:none;color:var(--silver);padding:0.8rem 1.5rem;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.3s;font-family:'Poppins',sans-serif}.tab-btn:hover{background:rgba(212,175,55,0.1);color:var(--royal-gold)}.tab-btn.active{background:var(--gradient-gold);color:var(--deep-navy)}.table-container{background:var(--card-bg);backdrop-filter:blur(20px);border:2px solid var(--glass-border);border-radius:20px;overflow:hidden;margin-bottom:2rem;box-shadow:0 15px 40px rgba(0,0,0,0.4)}table{width:100%;border-collapse:collapse;color:var(--platinum)}thead{background:rgba(15,23,42,0.95);position:sticky;top:0;z-index:10}th{padding:1.2rem 1rem;text-align:left;font-weight:700;border-bottom:2px solid var(--royal-gold);white-space:nowrap;color:var(--royal-gold);font-size:0.95rem}th.sortable{cursor:pointer;user-select:none;transition:all 0.3s}th.sortable:hover{background:rgba(212,175,55,0.1)}td{padding:1.2rem 1rem;border-bottom:1px solid rgba(212,175,55,0.1);font-size:0.9rem}tbody tr{transition:all 0.3s}tbody tr:hover{background:rgba(212,175,55,0.05)}.status-badge{padding:0.5rem 1rem;border-radius:8px;font-size:0.85rem;font-weight:700;display:inline-block;text-transform:uppercase;letter-spacing:0.5px}.status-badge.success{background:rgba(16,185,129,0.2);color:var(--success);border:1px solid var(--success)}.status-badge.warning{background:rgba(239,68,68,0.2);color:var(--danger);border:1px solid var(--danger)}.match-score{font-weight:800;font-size:1.1rem}.match-score.high{color:var(--success)}.match-score.medium{color:var(--warning)}.match-score.low{color:var(--danger)}.aging-badge{padding:0.4rem 0.8rem;border-radius:6px;font-size:0.8rem;font-weight:700;border:1px solid}.aging-current{background:rgba(16,185,129,0.2);color:var(--success);border-color:var(--success)}.aging-30{background:rgba(245,158,11,0.2);color:var(--warning);border-color:var(--warning)}.aging-60{background:rgba(249,115,22,0.2);color:#f97316;border-color:#f97316}.aging-90{background:rgba(239,68,68,0.2);color:var(--danger);border-color:var(--danger)}.pagination{display:flex;justify-content:center;gap:0.5rem;margin-top:2rem}.pagination button{background:var(--card-bg);border:2px solid var(--glass-border);color:var(--platinum);padding:0.8rem 1.2rem;border-radius:10px;cursor:pointer;min-width:45px;font-weight:600;transition:all 0.3s;font-family:'Poppins',sans-serif}.pagination button:hover:not(:disabled){background:rgba(212,175,55,0.2);border-color:var(--royal-gold);transform:translateY(-2px)}.pagination button.active{background:var(--gradient-gold);color:var(--deep-navy);border-color:var(--royal-gold)}.pagination button:disabled{opacity:0.3;cursor:not-allowed}.hidden{display:none!important}.alert{background:rgba(239,68,68,0.1);border:2px solid var(--danger);border-radius:12px;padding:1.5rem;margin:2rem 0;color:var(--danger);font-weight:600}.alert-success{background:rgba(16,185,129,0.1);border-color:var(--success);color:var(--success)}@media (max-width:768px){.upload-grid,.charts-grid,.stats-grid{grid-template-columns:1fr}.table-container{overflow-x:auto}table{font-size:0.8rem}th,td{padding:0.8rem 0.6rem}}</style>
</head>
<body>
<header class="header"><div class="container header-content"><div class="logo"><svg width="45" height="45" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg><h1>O2C RECONCILIATION</h1><span class="badge"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>PREMIUM</span></div><nav class="nav"><button class="nav-btn">Dashboard</button><button class="nav-btn">Analytics</button><button class="nav-btn">Reports</button></nav></div></header>
<main class="main-content container">
<section class="upload-section"><div class="section-header"><h2>Upload Your Data</h2><p>Advanced AI-powered reconciliation with accurate data extraction</p></div><div class="upload-grid"><div class="upload-box" id="invoice-upload-box"><input type="file" id="invoice-file" accept=".xlsx,.xls,.csv" class="file-input"><label for="invoice-file" class="upload-label"><svg class="upload-icon" width="70" height="70" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg><h3>Invoice Data</h3><p>Upload your invoice Excel file</p><span class="file-name" id="invoice-name"></span></label><div class="data-preview" id="invoice-preview"></div></div><div class="upload-box" id="bank-upload-box"><input type="file" id="bank-file" accept=".xlsx,.xls,.csv" class="file-input"><label for="bank-file" class="upload-label"><svg class="upload-icon" width="70" height="70" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg><h3>Bank Statement</h3><p>Upload your bank Excel file</p><span class="file-name" id="bank-name"></span></label><div class="data-preview" id="bank-preview"></div></div></div><div style="text-align:center;margin-top:2rem"><button id="generate-sample" class="btn-secondary"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path></svg>Generate Sample Data</button></div></section>
<section class="reconciliation-engine hidden" id="engine-section"><div class="engine-content"><div class="engine-icon rotating"><svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"></rect><rect x="9" y="9" width="6" height="6"></rect></svg></div><h2>AI Reconciliation Engine</h2><p id="status" style="color:var(--silver);font-size:1.2rem;margin:1rem 0">Initializing advanced matching algorithms...</p><div class="progress-bar"><div class="progress-fill" id="progress"></div></div><div class="progress-text" id="progress-text">0%</div></div></section>
<section class="data-visualization hidden" id="visualization-section"><div class="section-header"><h2>Reconciliation Analytics</h2><p>Comprehensive insights and detailed analysis</p></div><div class="stats-grid" id="stats-grid"></div><div class="charts-grid"><div class="chart-card"><h3>Distribution Overview</h3><canvas id="pieChart"></canvas></div><div class="chart-card"><h3>Reconciliation Summary</h3><canvas id="barChart"></canvas></div></div></section>
<section class="results-section hidden" id="results-section"><div class="section-header"><h2>Detailed Reconciliation Results</h2><button id="export-btn" class="btn-primary"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline></svg>Export to Excel</button></div><div class="table-controls"><div class="search-box"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg><input type="search" id="search-input" placeholder="Search invoices, customers, amounts..."></div><div class="filter-tabs"><button class="tab-btn active" data-filter="all">All Transactions</button><button class="tab-btn" data-filter="matched">Matched</button><button class="tab-btn" data-filter="unmatched">Unmatched</button></div></div><div class="table-container"><table><thead><tr><th class="sortable" data-sort="invoiceNumber">Invoice #</th><th class="sortable" data-sort="customerName">Customer Name</th><th class="sortable" data-sort="amount">Amount</th><th class="sortable" data-sort="invoiceDate">Invoice Date</th><th class="sortable" data-sort="dueDate">Due Date</th><th class="sortable" data-sort="agingDays">Aging</th><th>Bank Reference</th><th>Bank Date</th><th class="sortable" data-sort="matchScore">Match Score</th><th>Status</th></tr></thead><tbody id="results-tbody"></tbody></table></div><div class="pagination" id="pagination"></div></section>
</main>
<script>const S={invoiceData:null,bankData:null,results:null,currentFilter:'all',currentSort:{column:null,direction:'asc'},currentPage:1,itemsPerPage:15,searchQuery:'',config:{amountWeight:70,dateWeight:20,referenceWeight:10,threshold:75}};let pieChart,barChart;document.addEventListener('DOMContentLoaded',()=>{document.getElementById('invoice-file').addEventListener('change',e=>handleFileUpload(e,'invoice'));document.getElementById('bank-file').addEventListener('change',e=>handleFileUpload(e,'bank'));document.getElementById('generate-sample').addEventListener('click',generateSampleData);document.getElementById('export-btn').addEventListener('click',exportToExcel);document.getElementById('search-input').addEventListener('input',handleSearch);document.querySelectorAll('.tab-btn').forEach(b=>b.addEventListener('click',e=>handleFilterChange(e.target.dataset.filter)));document.querySelectorAll('th.sortable').forEach(t=>t.addEventListener('click',()=>handleSort(t.dataset.sort)))});async function handleFileUpload(e,type){const file=e.target.files[0];if(!file)return;try{const data=await parseExcelFile(file);console.log('Parsed data:',data);if(type==='invoice'){S.invoiceData=normalizeInvoiceData(data);console.log('Normalized invoice data:',S.invoiceData);document.getElementById('invoice-name').textContent=file.name;document.getElementById('invoice-upload-box').classList.add('uploaded');showDataPreview(S.invoiceData,'invoice-preview','Invoice')}else{S.bankData=normalizeBankData(data);console.log('Normalized bank data:',S.bankData);document.getElementById('bank-name').textContent=file.name;document.getElementById('bank-upload-box').classList.add('uploaded');showDataPreview(S.bankData,'bank-preview','Bank')}if(S.invoiceData&&S.bankData)await startReconciliation()}catch(err){console.error('Error:',err);alert('Error parsing file: '+err.message)}}function parseExcelFile(file){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=e=>{try{const data=new Uint8Array(e.target.result);const wb=XLSX.read(data,{type:'array',cellDates:true,cellNF:true,cellText:false,raw:false});const sheet=wb.Sheets[wb.SheetNames[0]];const jsonData=XLSX.utils.sheet_to_json(sheet,{raw:false,defval:'',dateNF:'yyyy-mm-dd'});console.log('Raw Excel data:',jsonData);resolve(jsonData)}catch(err){reject(err)}};reader.onerror=()=>reject(new Error('Failed to read file'));reader.readAsArrayBuffer(file)})}function getFieldValue(row,...keys){for(let k of keys){const val=row[k];if(val!==undefined&&val!==null&&val!==''){return String(val).trim()}}return''}function normalizeInvoiceData(data){return data.map((row,idx)=>{const amount=parseFloat(getFieldValue(row,'Amount','amount','AMOUNT','Invoice Amount','InvoiceAmount','invoice_amount','Total','TOTAL','Value','VALUE','Debit','DEBIT').replace(/[^0-9.-]/g,''))||0;const invNum=getFieldValue(row,'InvoiceNumber','Invoice Number','Invoice_Number','invoice_number','InvoiceNo','Invoice No','Invoice_No','INV_NO','INVOICE_NO','Inv No','Document Number','DocumentNumber','Bill No','BillNo')||`INV-${String(idx+1).padStart(5,'0')}`;const customer=getFieldValue(row,'CustomerName','Customer Name','Customer_Name','customer_name','Customer','CUSTOMER','Client','CLIENT','ClientName','Client Name','Party Name','PartyName','PARTY_NAME','Account Name','AccountName','Debtor','DEBTOR')||'Unknown Customer';const invDate=getFieldValue(row,'InvoiceDate','Invoice Date','Invoice_Date','invoice_date','Date','DATE','Inv Date','InvDate','Document Date','DocumentDate','Transaction Date','TransactionDate','Posting Date','PostingDate')||new Date().toISOString().split('T')[0];const dueDate=getFieldValue(row,'DueDate','Due Date','Due_Date','due_date','PaymentDue','Payment Due','Payment_Due','Maturity Date','MaturityDate','Expiry Date','ExpiryDate')||'';const ref=getFieldValue(row,'Reference','reference','REFERENCE','Ref','REF','ReferenceNumber','Reference Number','Reference_Number','CustomerRef','Customer Ref','PO Number','PONumber','PO_Number','Order Number','OrderNumber')||'';const desc=getFieldValue(row,'Description','description','DESCRIPTION','Desc','DESC','Narration','NARRATION','Particulars','PARTICULARS','Details','DETAILS','Remarks','REMARKS')||'';const invDateObj=new Date(invDate);const today=new Date();const agingDays=Math.floor((today-invDateObj)/(1000*60*60*24));return{invoiceNumber:invNum,customerName:customer,amount:amount,invoiceDate:invDate,dueDate:dueDate,reference:ref,description:desc,agingDays:agingDays>=0?agingDays:0}})}function normalizeBankData(data){return data.map((row,idx)=>{const amount=parseFloat(getFieldValue(row,'Amount','amount','AMOUNT','Credit','CREDIT','Deposit','DEPOSIT','deposit','Value','VALUE','Transaction Amount','TransactionAmount','Debit','DEBIT','Withdrawal','WITHDRAWAL').replace(/[^0-9.-]/g,''))||0;const ref=getFieldValue(row,'Reference','reference','REFERENCE','Ref','REF','ReferenceNumber','Reference Number','Reference_Number','BankRef','Bank Ref','Bank_Ref','TransactionRef','Transaction Ref','Transaction_Ref','UTR','UTR Number','UTR_Number','Cheque No','ChequeNo','Cheque_No','Check Number','CheckNumber')||`BANK-${String(idx+1).padStart(5,'0')}`;const date=getFieldValue(row,'Date','date','DATE','TransactionDate','Transaction Date','Transaction_Date','ValueDate','Value Date','Value_Date','Posting Date','PostingDate','Posting_Date')||new Date().toISOString().split('T')[0];const desc=getFieldValue(row,'Description','description','DESCRIPTION','Narration','NARRATION','Particulars','PARTICULARS','Details','DETAILS','Remarks','REMARKS','Transaction Details','TransactionDetails')||'';const payee=getFieldValue(row,'Payee','payee','PAYEE','Payer','PAYER','Party','PARTY','Beneficiary','BENEFICIARY','Account Holder','AccountHolder','Customer Name','CustomerName')||'';return{reference:ref,amount:Math.abs(amount),date:date,description:desc,payee:payee}})}function showDataPreview(data,elementId,type){const el=document.getElementById(elementId);if(!data||data.length===0){el.classList.remove('show');return}const sample=data.slice(0,5);let html=`<h4><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>Successfully loaded ${data.length} ${type} records</h4><table><thead><tr>`;if(type==='Invoice'){html+=`<th>Invoice #</th><th>Customer</th><th>Amount</th><th>Date</th><th>Aging</th>`}else{html+=`<th>Reference</th><th>Amount</th><th>Date</th><th>Payee</th>`}html+=`</tr></thead><tbody>`;sample.forEach(row=>{html+=`<tr>`;if(type==='Invoice'){html+=`<td>${row.invoiceNumber||''}</td><td>${row.customerName||''}</td><td>$${(row.amount||0).toLocaleString('en-US',{minimumFractionDigits:2})}</td><td>${row.invoiceDate||''}</td><td>${row.agingDays||0} days</td>`}else{html+=`<td>${row.reference||''}</td><td>$${(row.amount||0).toLocaleString('en-US',{minimumFractionDigits:2})}</td><td>${row.date||''}</td><td>${row.payee||''}</td>`}html+=`</tr>`});html+=`</tbody></table>`;el.innerHTML=html;el.classList.add('show')}function generateSampleData(){const inv=[];const customers=['Acme Corporation','Global Industries Ltd','Tech Solutions Inc','Prime Enterprises','Metro Systems LLC','Alpha Trading Co','Beta Manufacturing','Gamma Services Group'];for(let i=1;i<=50;i++){const amt=Math.round((Math.random()*50000+5000)*100)/100;const invDate=new Date();invDate.setDate(invDate.getDate()-Math.floor(Math.random()*120));const dueDate=new Date(invDate);dueDate.setDate(dueDate.getDate()+30);const aging=Math.floor((new Date()-invDate)/(1000*60*60*24));inv.push({invoiceNumber:`INV-2024-${String(i).padStart(5,'0')}`,customerName:customers[i%customers.length],amount:amt,invoiceDate:invDate.toISOString().split('T')[0],dueDate:dueDate.toISOString().split('T')[0],reference:`PO-${String(i).padStart(4,'0')}`,description:`Professional services invoice ${i}`,agingDays:aging})}const bnk=[];for(let i=1;i<=45;i++){let amt,ref,dt,payee;if(i<=45&&inv[i-1]){amt=inv[i-1].amount+(Math.random()>.95?(Math.random()-.5)*100:0);ref=inv[i-1].reference;payee=inv[i-1].customerName;const id=new Date(inv[i-1].invoiceDate);id.setDate(id.getDate()+Math.floor(Math.random()*7));dt=id.toISOString().split('T')[0]}else{amt=Math.round((Math.random()*50000+5000)*100)/100;ref=`TXN-${String(i).padStart(6,'0')}`;payee='Various';const rd=new Date();rd.setDate(rd.getDate()-Math.floor(Math.random()*90));dt=rd.toISOString().split('T')[0]}bnk.push({reference:ref,amount:Math.round(amt*100)/100,date:dt,description:`Bank transfer payment ${i}`,payee:payee})}S.invoiceData=inv;S.bankData=bnk;document.getElementById('invoice-name').textContent='Sample_Invoices.xlsx';document.getElementById('invoice-upload-box').classList.add('uploaded');showDataPreview(inv,'invoice-preview','Invoice');document.getElementById('bank-name').textContent='Sample_Bank.xlsx';document.getElementById('bank-upload-box').classList.add('uploaded');showDataPreview(bnk,'bank-preview','Bank');startReconciliation()}async function startReconciliation(){document.getElementById('engine-section').classList.remove('hidden');document.getElementById('engine-section').scrollIntoView({behavior:'smooth'});await updateProgress(0,'Initializing AI engine...');await sleep(600);await updateProgress(25,'Parsing invoice data...');await sleep(900);await updateProgress(50,'Analyzing bank statements...');await sleep(900);await updateProgress(75,'Computing match scores...');await sleep(1000);await updateProgress(90,'Applying reconciliation rules...');await sleep(800);performReconciliation();await updateProgress(100,'Reconciliation complete!');await sleep(600);document.getElementById('engine-section').classList.add('hidden');displayResults()}function updateProgress(p,s){return new Promise(r=>{document.getElementById('progress').style.width=p+'%';document.getElementById('progress-text').textContent=p+'%';document.getElementById('status').textContent=s;setTimeout(r,100)})}function sleep(ms){return new Promise(r=>setTimeout(r,ms))}function performReconciliation(){const matched=[],unmatched=[],used=new Set();S.invoiceData.forEach(inv=>{let best=null,score=0,idx=-1;S.bankData.forEach((b,i)=>{if(used.has(i))return;const sc=calculateMatchScore(inv,b);if(sc>score){score=sc;best=b;idx=i}});if(score>=S.config.threshold){used.add(idx);matched.push({invoiceNumber:inv.invoiceNumber,customerName:inv.customerName,amount:inv.amount,invoiceDate:inv.invoiceDate,dueDate:inv.dueDate,agingDays:inv.agingDays,bankReference:best.reference,bankDate:best.date,bankPayee:best.payee,matchScore:Math.round(score),status:'matched',difference:Math.abs(inv.amount-best.amount)})}else{unmatched.push({invoiceNumber:inv.invoiceNumber,customerName:inv.customerName,amount:inv.amount,invoiceDate:inv.invoiceDate,dueDate:inv.dueDate,agingDays:inv.agingDays,bankReference:best?best.reference:'N/A',bankDate:best?best.date:'',bankPayee:best?best.payee:'',matchScore:best?Math.round(score):0,status:'unmatched',reason:best?'Score below threshold':'No matching transaction found'})}});const total=S.invoiceData.reduce((s,i)=>s+i.amount,0);const mamt=matched.reduce((s,m)=>s+m.amount,0);S.results={matched,unmatched,summary:{totalInvoices:S.invoiceData.length,matchedCount:matched.length,unmatchedCount:unmatched.length,matchRate:((matched.length/S.invoiceData.length)*100).toFixed(1),totalAmount:total,matchedAmount:mamt,unmatchedAmount:total-mamt}};console.log('Reconciliation results:',S.results)}function calculateMatchScore(inv,bnk){let sc=0;const diff=Math.abs(inv.amount-bnk.amount);const thr=inv.amount*0.02;const asc=diff<=thr?100:Math.max(0,100-(diff/inv.amount*100));sc+=(asc*S.config.amountWeight/100);const id=new Date(inv.invoiceDate),bd=new Date(bnk.date);const dd=Math.abs((id-bd)/(1000*60*60*24));const dsc=Math.max(0,100-(dd*8));sc+=(dsc*S.config.dateWeight/100);const ir=(inv.reference||'').toLowerCase(),br=(bnk.reference||'').toLowerCase();let rsc=0;if(ir&&br){if(ir===br)rsc=100;else if(ir.includes(br)||br.includes(ir))rsc=75;else{const iw=ir.split(/[-_\s]/),bw=br.split(/[-_\s]/);const common=iw.filter(w=>bw.includes(w)&&w.length>2);if(common.length>0)rsc=50}}sc+=(rsc*S.config.referenceWeight/100);return sc}function displayResults(){document.getElementById('visualization-section').classList.remove('hidden');document.getElementById('results-section').classList.remove('hidden');displayStats();displayCharts();displayTable();document.getElementById('visualization-section').scrollIntoView({behavior:'smooth'})}function displayStats(){const{summary:s}=S.results;document.getElementById('stats-grid').innerHTML=`<div class="stat-card"><div class="stat-icon-wrapper"><svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="var(--royal-gold)" stroke-width="2.5"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg></div><div class="stat-content"><h4>Match Rate</h4><div class="stat-value">${s.matchRate}%</div><p class="stat-subtitle">Reconciliation accuracy</p></div></div><div class="stat-card"><div class="stat-icon-wrapper"><svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="var(--royal-gold)" stroke-width="2.5"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></div><div class="stat-content"><h4>Total Amount</h4><div class="stat-value">$${s.totalAmount.toLocaleString('en-US',{minimumFractionDigits:2})}</div><p class="stat-subtitle">Total invoice value</p></div></div><div class="stat-card"><div class="stat-icon-wrapper"><svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg></div><div class="stat-content"><h4>Matched</h4><div class="stat-value">${s.matchedCount}</div><p class="stat-subtitle">$${s.matchedAmount.toLocaleString('en-US',{minimumFractionDigits:2})}</p></div></div><div class="stat-card"><div class="stat-icon-wrapper"><svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="var(--danger)" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg></div><div class="stat-content"><h4>Unmatched</h4><div class="stat-value">${s.unmatchedCount}</div><p class="stat-subtitle">$${s.unmatchedAmount.toLocaleString('en-US',{minimumFractionDigits:2})}</p></div></div>`}function displayCharts(){const{summary:s}=S.results;if(pieChart)pieChart.destroy();if(barChart)barChart.destroy();pieChart=new Chart(document.getElementById('pieChart').getContext('2d'),{type:'doughnut',data:{labels:['Matched','Unmatched'],datasets:[{data:[s.matchedCount,s.unmatchedCount],backgroundColor:['#10b981','#ef4444'],borderWidth:3,borderColor:'#0f172a'}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{labels:{color:'#f8fafc',font:{size:14,weight:'600',family:'Poppins'}}}}}});barChart=new Chart(document.getElementById('barChart').getContext('2d'),{type:'bar',data:{labels:['Total Invoices','Matched','Unmatched'],datasets:[{data:[s.totalInvoices,s.matchedCount,s.unmatchedCount],backgroundColor:['#3b82f6','#10b981','#ef4444'],borderRadius:10,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{color:'#f8fafc',font:{family:'Poppins'}},grid:{color:'rgba(212,175,55,0.1)'}},x:{ticks:{color:'#f8fafc',font:{family:'Poppins'}},grid:{color:'rgba(212,175,55,0.1)'}}}}})}function getAgingBadge(days){if(days<=30)return`<span class="aging-badge aging-current">${days}d Current</span>`;if(days<=60)return`<span class="aging-badge aging-30">${days}d (30+)</span>`;if(days<=90)return`<span class="aging-badge aging-60">${days}d (60+)</span>`;return`<span class="aging-badge aging-90">${days}d (90+)</span>`}function displayTable(){S.currentPage=1;renderTable();renderPagination()}function renderTable(){const tbody=document.getElementById('results-tbody');let data=[...S.results.matched,...S.results.unmatched];if(S.currentFilter==='matched')data=data.filter(i=>i.status==='matched');if(S.currentFilter==='unmatched')data=data.filter(i=>i.status==='unmatched');if(S.searchQuery){const q=S.searchQuery.toLowerCase();data=data.filter(i=>(i.invoiceNumber||'').toLowerCase().includes(q)||(i.customerName||'').toLowerCase().includes(q)||i.amount.toString().includes(q)||(i.invoiceDate||'').includes(q)||(i.bankReference||'').toLowerCase().includes(q))}if(S.currentSort.column){data.sort((a,b)=>{let av=a[S.currentSort.column]||'',bv=b[S.currentSort.column]||'';if(S.currentSort.column==='amount'||S.currentSort.column==='matchScore'||S.currentSort.column==='agingDays'){av=parseFloat(av)||0;bv=parseFloat(bv)||0}if(av<bv)return S.currentSort.direction==='asc'?-1:1;if(av>bv)return S.currentSort.direction==='asc'?1:-1;return 0})}const start=(S.currentPage-1)*S.itemsPerPage;const page=data.slice(start,start+S.itemsPerPage);tbody.innerHTML=page.map(i=>{const sc=i.matchScore>=90?'high':i.matchScore>=70?'medium':'low';const st=i.status==='matched'?'success':'warning';const tx=i.status==='matched'?'✓ MATCHED':'⚠ UNMATCHED';return`<tr><td><strong>${i.invoiceNumber||''}</strong></td><td>${i.customerName||''}</td><td><strong>$${i.amount.toLocaleString('en-US',{minimumFractionDigits:2})}</strong></td><td>${i.invoiceDate||''}</td><td>${i.dueDate||''}</td><td>${getAgingBadge(i.agingDays||0)}</td><td>${i.bankReference||'N/A'}</td><td>${i.bankDate||''}</td><td><span class="match-score ${sc}">${i.matchScore}%</span></td><td><span class="status-badge ${st}">${tx}</span></td></tr>`}).join('');S.filteredData=data}function renderPagination(){const pg=document.getElementById('pagination');const total=Math.ceil((S.filteredData?.length||0)/S.itemsPerPage);if(total<=1){pg.innerHTML='';return}let h=`<button ${S.currentPage===1?'disabled':''} onclick="changePage(${S.currentPage-1})">‹ Prev</button>`;for(let i=1;i<=total;i++){if(i===1||i===total||(i>=S.currentPage-2&&i<=S.currentPage+2)){h+=`<button class="${i===S.currentPage?'active':''}" onclick="changePage(${i})">${i}</button>`}else if(i===S.currentPage-3||i===S.currentPage+3){h+='<span style="color:var(--silver);padding:0 0.5rem">...</span>'}}h+=`<button ${S.currentPage===total?'disabled':''} onclick="changePage(${S.currentPage+1})">Next ›</button>`;pg.innerHTML=h}function changePage(p){S.currentPage=p;renderTable();renderPagination()}function handleSearch(e){S.searchQuery=e.target.value;S.currentPage=1;renderTable();renderPagination()}function handleFilterChange(f){S.currentFilter=f;S.currentPage=1;document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.filter===f));renderTable();renderPagination()}function handleSort(c){if(S.currentSort.column===c){S.currentSort.direction=S.currentSort.direction==='asc'?'desc':'asc'}else{S.currentSort.column=c;S.currentSort.direction='asc'}renderTable()}function exportToExcel(){const wb=XLSX.utils.book_new();const{summary:s,matched:m,unmatched:u}=S.results;const sum=[['O2C RECONCILIATION - COMPREHENSIVE REPORT'],['Generated:',new Date().toLocaleString()],[''],['EXECUTIVE SUMMARY'],['Total Invoices',s.totalInvoices],['Matched Transactions',s.matchedCount],['Unmatched Transactions',s.unmatchedCount],['Match Rate',s.matchRate+'%'],[''],['FINANCIAL SUMMARY'],['Total Invoice Amount','$'+s.totalAmount.toLocaleString('en-US',{minimumFractionDigits:2})],['Matched Amount','$'+s.matchedAmount.toLocaleString('en-US',{minimumFractionDigits:2})],['Unmatched Amount','$'+s.unmatchedAmount.toLocaleString('en-US',{minimumFractionDigits:2})]];XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(sum),'Executive Summary');if(m.length>0){const mExp=m.map(x=>({'Invoice Number':x.invoiceNumber,'Customer Name':x.customerName,'Invoice Amount':x.amount,'Invoice Date':x.invoiceDate,'Due Date':x.dueDate,'Aging (Days)':x.agingDays,'Bank Reference':x.bankReference,'Bank Date':x.bankDate,'Bank Payee':x.bankPayee,'Match Score (%)':x.matchScore,'Amount Difference':x.difference||0,'Status':'MATCHED'}));XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(mExp),'Matched Transactions')}if(u.length>0){const uExp=u.map(x=>({'Invoice Number':x.invoiceNumber,'Customer Name':x.customerName,'Invoice Amount':x.amount,'Invoice Date':x.invoiceDate,'Due Date':x.dueDate,'Aging (Days)':x.agingDays,'Match Score (%)':x.matchScore,'Reason':x.reason||'No match found','Status':'UNMATCHED'}));XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(uExp),'Unmatched Transactions')}const fileName=`O2C_Reconciliation_Report_${new Date().toISOString().split('T')[0]}_${Date.now()}.xlsx`;XLSX.writeFile(wb,fileName)}window.changePage=changePage;</script>
</body>
</html>